@startuml
title UC 63 - Archiver des données

|Administrateur|
|Interface Administration (UI)|
|Système d'Archivage (Backend)|
|Base de Données (DB)|
|Stockage d'Archives (Secondaire)|
|Service d'Audit (Audit Service)|

start

|Administrateur|
:Naviguer vers section archivage;

|Interface Administration (UI)|
:Afficher interface d'archivage;
:Afficher types de données archivables et règles;

|Administrateur|
:Sélectionner type(s) de données à archiver;
:Ajuster critères (Optionnel);
:Lancer le processus d'archivage;

|Interface Administration (UI)|
:Envoyer requête de lancement [Type(s) Données, Critères];

|Système d'Archivage (Backend)|
:Recevoir requête;
:Identifier données éligibles à l'archivage (selon règles/critères);

if (Données éligibles trouvées - Alt A2 si aucune) then (oui)
  :Initialiser journal / rapport d'archivage;

  fork
    |Système d'Archivage (Backend)|
    repeat
      :Traiter élément éligible;
      :Vérifier dépendances / cohérence de l'élément;
      if (Archivage élément possible) then (oui)
        :Exécuter action d'archivage pour l'élément\n(Marquer, Déplacer en DB/Stockage secondaire);
        |Base de Données (DB)|
        |Stockage d'Archives (Secondaire)|
        :Enregistrer/Déplacer données élément;
        |Système d'Archivage (Backend)|
        :Journaliser succès pour l'élément;
      else (non - Alt A3)
        :Journaliser échec et raison pour l'élément;
      endif
    repeat while (Il reste des éléments éligibles à traiter)
  fork again
    |Interface Administration (UI)|
    :Afficher statut du processus (si en arrière-plan);
    |Administrateur|
    :Suivre statut (Optionnel);
  end fork

  |Système d'Archivage (Backend)|
  :Finaliser rapport de résumé de l'archivage;
  |Service d'Audit (Audit Service)|
  :Enregistrer action archivage (Qui, Quand, Type(s), Critères, Résultat résumé);
  |Système d'Archivage (Backend)|
  :Envoyer rapport de résumé à l'UI;

  |Interface Administration (UI)|
  :Afficher rapport de résumé;
  |Administrateur|
  :Consulter rapport (Nb succès, Nb échecs, Détails échecs);

  stop

else (non - Alt A2 - Aucune donnée éligible)
  |Système d'Archivage (Backend)|
  :Signaler aucune donnée éligible;
  |Interface Administration (UI)|
  :Afficher message "Aucune donnée à archiver...";
  |Administrateur|
  :Prendre connaissance du message;
  stop
endif

|Système d'Archivage (Backend)|
-downto-> |Système d'Archivage (Backend)|: Enregistrer log erreur critique (Exc E1) #pink;
|Interface Administration (UI)|
:Afficher message d'erreur générique (Exc E1);
|Administrateur|
:Prendre connaissance de l'erreur;
stop


@enduml
