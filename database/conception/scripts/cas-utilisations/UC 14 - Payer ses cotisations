@startuml
title UC 14 - Payer ses cotisations

|Mutualiste|
start
:Se connecter à son espace personnel (UC 1);
:Naviguer vers section paiements cotisations;

|Interface Utilisateur (UI)|
:Afficher cotisations dues et options de paiement;

|Mutualiste|
:Choisir montant et méthode de paiement;

|Système de Paiement (Backend)|
:Enregistrer transaction interne (Statut: Initiée);

split
  |Système de Paiement (Backend)|
  -> Si Carte Bancaire;
  :Initier transaction CB;
  |Passerelle de Paiement (Externe)|
  |UI|
  :Rediriger vers/Afficher formulaire sécurisé CB;
  |Mutualiste|
  :Saisir informations carte;
  :Confirmer paiement CB;
  |Passerelle de Paiement (Externe)|
  :Communiquer avec Banque\n(Autorisation, 3D Secure);
  :Notifier Système de Paiement du résultat;

split again
  |Système de Paiement (Backend)|
  -> Si Orange Money/Mobile Money;
  :Initier transaction OM/MOMO;
  |UI|
  :Inviter confirmation numéro mobile;
  |Mutualiste|
  :Confirmer/Saisir numéro mobile;
  |Système de Paiement (Backend)|
  :Envoyer requête initiation transaction OM/MOMO;
  |Passerelle de Paiement (Externe)|
  :Envoyer notification (USSD/SMS/Pop-up) au mobile;
  |Mutualiste|
  :Saisir code PIN sur mobile\npour confirmer;
  |Passerelle de Paiement (Externe)|
  :Traiter transaction mobile;
  :Notifier Système de Paiement du résultat;
end split

|Système de Paiement (Backend)|
:Recevoir notification de la Passerelle;
:Traiter le résultat de la transaction;

if (Résultat transaction) then (Succès)
  :Mettre à jour statut transaction (Succès);
  :Marquer cotisations comme payées;
  :Ajuster statut mutualiste (si impayés résolus);
  :Enregistrer historique complet;
  |UI|
  :Générer et afficher reçu/confirmation;
  |Système de Paiement (Backend)|
  :Envoyer confirmation (Email/SMS) au Mutualiste;
  :Rediriger vers page Cotisations/Tableau de bord;
  stop
else (Échec/Refus ou Annulé)
  |Système de Paiement (Backend)|
  :Mettre à jour statut transaction\n(Échec/Refusé/Annulée);
  :Enregistrer historique transaction échouée/annulée;
  |UI|
  :Afficher message d'erreur ou d'annulation;
  :Rester sur page paiement\n/ Rediriger vers page échec;
  stop
endif
@enduml
