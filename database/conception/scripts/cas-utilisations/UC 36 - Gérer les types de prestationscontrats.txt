title UC 36 - Gérer les types de prestations/contrats

Acteurs: Administrateur
Lifelines:
  Administrateur
  Interface Administration (UI Admin)
  Système de Configuration (Backend/Système)
  Base de Données (DB)
  Service d'Audit (Audit Service)

Flux:
  Administrateur -> UI Admin: Accéder section configuration prestations/contrats
  UI Admin -> Système de Configuration: Demander liste types prestations/modèles contrats
  Système de Configuration -> DB: Récupérer liste prestations/contrats
  DB --> Système de Configuration: Retourner liste
  Système de Configuration --> UI Admin: Envoyer liste (Résumé: Nom, Statut, etc.)
  UI Admin --> Administrateur: Afficher liste avec options (Créer, Visualiser/Modifier, Activer/Désactiver)

  Alt [Sous-Scénario A : Créer un nouveau type de prestation ou modèle de contrat]
    Administrateur -> UI Admin: Cliquer "Créer type de prestation/modèle de contrat"
    UI Admin --> Administrateur: Afficher formulaire de saisie (selon type)

    Administrateur -> UI Admin: Saisir informations et définir règles/paramètres
    Administrateur -> UI Admin: Définir statut initial
    Administrateur -> UI Admin: Cliquer "Enregistrer" / "Créer"

    UI Admin -> Système de Configuration: Envoyer données nouvel élément
    Système de Configuration -> Système de Configuration: Valider données et règles (Alt A2, A4)

    Alt [Validation réussie]
      Système de Configuration -> DB: Créer nouvel enregistrement (Prestation/Contrat) avec règles
      DB --> Système de Configuration: Confirmation création
      Système de Configuration -> Service d'Audit: Enregistrer action création config (Qui, Quand, Détails)
      Service d'Audit --> Système de Configuration: Confirmation audit
      Système de Configuration --> UI Admin: Indiquer Succès Création
      UI Admin --> Administrateur: Afficher message succès et mettre à jour liste

    Alt [Validation KO (Alt A2, A4)]
      Système de Configuration --> UI Admin: Indiquer Échec Validation avec erreurs/motifs
      UI Admin --> Administrateur: Afficher messages d'erreur sur formulaire

    Alt [Erreur Système lors création (Exc E2)]
      Système de Configuration -> Système de Configuration: Enregistrer log d'erreur technique
      Système de Configuration --> UI Admin: Indiquer Échec Technique
      UI Admin --> Administrateur: Afficher message générique

  Alt [Sous-Scénario M : Visualiser / Modifier un type de prestation ou modèle de contrat existant]
    Administrateur -> UI Admin: Sélectionner un élément dans la liste [ID Élément]
    UI Admin -> Système de Configuration: Demander informations détaillées de l'élément [ID Élément]
    Système de Configuration -> DB: Récupérer données élément (y compris règles) [ID Élément]

    Alt [Élément trouvé (Exc E1 si introuvable)]
      DB --> Système de Configuration: Retourner données élément
      Système de Configuration --> UI Admin: Envoyer données complètes de l'élément
      UI Admin --> Administrateur: Afficher formulaire pré-rempli (visualisation/modification)

      Administrateur -> UI Admin: Visualiser ou Modifier informations / règles / statut
      Administrateur -> UI Admin: Cliquer "Enregistrer les modifications"

      UI Admin -> Système de Configuration: Envoyer données modifiées [ID Élément, Données Modifiées]
      Système de Configuration -> Système de Configuration: Valider données et règles modifiées (Alt A2)

      Alt [Validation réussie]
        Système de Configuration -> DB: Mettre à jour enregistrement élément et règles [ID Élément, Données Modifiées]
        DB --> Système de Configuration: Confirmation mise à jour
        Système de Configuration -> Service d'Audit: Enregistrer action modification config (Qui, Quand, Détails)
        Service d'Audit --> Système de Configuration: Confirmation audit
        Système de Configuration --> UI Admin: Indiquer Succès Modification
        UI Admin --> Administrateur: Afficher message succès et mettre à jour liste

      Alt [Validation KO (Alt A2)]
        Système de Configuration --> UI Admin: Indiquer Échec Validation avec erreurs/motifs
        UI Admin --> Administrateur: Afficher messages d'erreur sur formulaire

      Alt [Erreur Système lors modification (Exc E2)]
        Système de Configuration -> Système de Configuration: Enregistrer log d'erreur technique
        Système de Configuration --> UI Admin: Indiquer Échec Technique
        UI Admin --> Administrateur: Afficher message générique

    Alt [Élément introuvable lors de la sélection (Exc E1)]
      DB --> Système de Configuration: Indiquer élément non trouvé
      Système de Configuration --> UI Admin: Indiquer erreur (élément introuvable)
      UI Admin --> Administrateur: Afficher message d'erreur / Retour à liste

  Alt [Sous-Scénario S : Activer / Désactiver rapidement depuis la liste]
    Administrateur -> UI Admin: Cliquer sur "Activer" ou "Désactiver" dans la liste [ID Élément]
    UI Admin --> Administrateur: Afficher boîte de confirmation

    Administrateur -> UI Admin: Confirmer l'action
    UI Admin -> Système de Configuration: Envoyer requête changement statut [ID Élément, Nouveau Statut]

    Système de Configuration -> DB: Vérifier préconditions désactivation (Alt A3) [ID Élément]
    DB --> Système de Configuration: Résultat vérification préconditions

    Alt [Préconditions OK]
      Système de Configuration -> DB: Mettre à jour statut élément [ID Élément, Nouveau Statut]
      DB --> Système de Configuration: Confirmation mise à jour statut
      Système de Configuration -> Service d'Audit: Enregistrer action changement statut (Qui, Quand, Élément, Statut)
      Service d'Audit --> Système de Configuration: Confirmation audit
      Système de Configuration --> UI Admin: Indiquer Succès Changement Statut
      UI Admin --> Administrateur: Afficher message succès et mettre à jour liste

    Alt [Désactivation bloquée (Alt A3)]
      Système de Configuration --> UI Admin: Indiquer Échec Désactivation avec raison (Dépendances)
      UI Admin --> Administrateur: Afficher message d'erreur/avertissement

    Alt [Élément introuvable (Exc E1)]
      DB --> Système de Configuration: Indiquer introuvable
      Système de Configuration --> UI Admin: Indiquer erreur (élément introuvable)
      UI Admin --> Administrateur: Afficher message d'erreur

    Alt [Erreur Système lors changement statut (Exc E2)]
      Système de Configuration -> Système de Configuration: Enregistrer log d'erreur technique
      Système de Configuration --> UI Admin: Indiquer Échec Technique
      UI Admin --> Administrateur: Afficher message générique

  Alt [Annulation par l'Administrateur (Alt A1)]
    Administrateur --> UI Admin: Cliquer "Annuler"
    UI Admin --> Administrateur: Rediriger / Fermer formulaire (pas d'action backend)
