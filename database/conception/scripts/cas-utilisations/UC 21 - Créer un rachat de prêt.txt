title UC 21 - Créer un rachat de prêt

Acteurs: Administrateur
Lifelines:
  Administrateur
  Interface Administration (UI Admin)
  Système de Gestion Rachats (Backend/Système)
  Base de Données (DB)
  Service d'Audit (Audit Service)
  Service de Notification (Optionnel)

Flux:
  Administrateur -> UI Admin: Accéder section gestion rachats de prêts
  Administrateur -> UI Admin: Cliquer "Créer nouveau rachat de prêt"
  UI Admin --> Administrateur: Afficher formulaire de création rachat

  Administrateur -> UI Admin: Rechercher/Sélectionner mutualiste bénéficiaire [ID Mutualiste]
  UI Admin -> Système de Gestion Rachats: Demander infos éligibilité/historique rachats mutualiste [ID Mutualiste]
  Système de Gestion Rachats -> DB: Récupérer infos mutualiste/rachats existants [ID Mutualiste]
  DB --> Système de Gestion Rachats: Retourner infos
  Système de Gestion Rachats --> UI Admin: Envoyer infos résumé mutualiste (éligibilité spécifique rachats, etc.)
  UI Admin --> Administrateur: Afficher infos résumé (Optionnel)

  Administrateur -> UI Admin: Saisir détails du rachat (Montant, Durée, Taux, Réfs dette rachetée, etc.)
  Administrateur -> UI Admin: Cliquer "Enregistrer" / "Créer Rachat de Prêt"

  UI Admin -> Système de Gestion Rachats: Envoyer données du nouveau rachat [ID Mutualiste, Données Rachat]

  Système de Gestion Rachats -> Système de Gestion Rachats: Valider données saisies et éligibilité métier spécifique rachats (Alt A2, A3, A4)

  Alt [Validation réussie]
    Système de Gestion Rachats -> Système de Gestion Rachats: Calculer et générer échéancier rachat
    Système de Gestion Rachats -> DB: Créer enregistrement rachat de prêt [Données Rachat, ID Mutualiste]
    DB --> Système de Gestion Rachats: Confirmation création rachat
    Système de Gestion Rachats -> DB: Associer et enregistrer échéancier rachat généré [ID Rachat, Données Échéancier]
    DB --> Système de Gestion Rachats: Confirmation enregistrement échéancier
    Système de Gestion Rachats -> Service d'Audit: Enregistrer action création rachat (Qui, Quand, Détails)
    Service d'Audit --> Système de Gestion Rachats: Confirmation audit

    Système de Gestion Rachats --> UI Admin: Indiquer Succès Création Rachat
    UI Admin --> Administrateur: Afficher message succès ("Rachat de prêt créé...")

    Opt [Notification au mutualiste (Exc E3)]
      Système de Gestion Rachats -> Service de Notification: Envoyer notification création rachat [ID Mutualiste, Infos Rachat/Échéancier]

  Alt [Validation ou éligibilité KO (Alt A2, A3, A4)]
    Système de Gestion Rachats --> UI Admin: Indiquer Échec Validation/Éligibilité avec erreurs/motifs
    UI Admin --> Administrateur: Afficher messages d'erreur sur formulaire

  Alt [Erreur Système lors création/calcul (Exc E2)]
    Système de Gestion Rachats -> Système de Gestion Rachats: Enregistrer log d'erreur technique
    Système de Gestion Rachats --> UI Admin: Indiquer Échec Technique
    UI Admin --> Administrateur: Afficher message d'erreur générique

  Alt [Mutualiste introuvable (Exc E1)]
    DB --> Système de Gestion Rachats: Indiquer mutualiste non trouvé
    Système de Gestion Rachats --> UI Admin: Indiquer erreur (mutualiste introuvable)
    UI Admin --> Administrateur: Afficher message d'erreur

  Alt [Annulation par l'Administrateur (Alt A1)]
    Administrateur --> UI Admin: Cliquer "Annuler"
    UI Admin --> Administrateur: Rediriger (pas d'action backend)
