title UC 69 - Enregistrer une entrée en caisse

Acteurs: Administrateur
Lifelines:
  Administrateur
  Interface Administration (UI Admin)
  Système Financier (Backend/Système)
  Base de Données (DB)
  Service d'Audit (Audit Service)
  Système de Gestion Documents (Optionnel - Justificatif)

Flux:
  Administrateur -> UI Admin: Se connecter à interface administration
  Administrateur -> UI Admin: Naviguer vers section gestion de caisse
  UI Admin --> Administrateur: Afficher interface gestion caisse (UC 71 implicite) avec option "Nouvelle entrée"

  Administrateur -> UI Admin: Cliquer "Enregistrer une entrée en caisse"
  UI Admin --> Administrateur: Afficher formulaire saisie entrée en caisse (Pré-rempli Type="Entrée", Date/Heure)

  Administrateur -> UI Admin: Saisir Montant, Source, Description, (Optionnel) Lier mutualiste, Joindre justificatif
  Administrateur -> UI Admin: Cliquer "Enregistrer l'entrée"

  UI Admin -> Système Financier: Envoyer données entrée en caisse et justificatif (Optionnel) [Données Entrée, Fichier]

  Système Financier -> Système Financier: Valider données (Alt A2) et justificatif (Alt A4)

  Alt [Validation réussie]
    Système Financier -> DB: Créer nouvel enregistrement entrée en caisse [Données Entrée]
    DB --> Système Financier: Confirmation création
    Système Financier -> DB: Mettre à jour solde caisse (+ Montant)
    DB --> Système Financier: Confirmation solde
    Opt [Justificatif joint]
      Système Financier -> Système de Gestion Documents: Traiter et associer justificatif
      Système de Gestion Documents --> Système Financier: Statut traitement (Alt A4 si échec)
    Système Financier -> Service d'Audit: Enregistrer action enregistrement entrée caisse (Qui, Quand, Quoi)
    Service d'Audit --> Système Financier: Confirmation audit
    Système Financier --> UI Admin: Indiquer Succès Enregistrement Entrée
    UI Admin --> Administrateur: Afficher message succès (avec nouveau solde)

  Alt [Validation KO (Alt A2) ou Échec Justificatif (Alt A4)]
    Système Financier --> UI Admin: Indiquer Échec Enregistrement avec erreurs/motifs
    UI Admin --> Administrateur: Afficher messages d'erreur sur formulaire

  Alt [Erreur Système lors enregistrement (Exc E1)]
    Système Financier -> Système Financier: Enregistrer log d'erreur technique
    Système Financier --> UI Admin: Indiquer Échec Technique
    UI Admin --> Administrateur: Afficher message générique

  Alt [Annulation par l'Administrateur (Alt A1)]
    Administrateur --> UI Admin: Cliquer "Annuler" / Quitter
    UI Admin --> Administrateur: Abandonner formulaire
