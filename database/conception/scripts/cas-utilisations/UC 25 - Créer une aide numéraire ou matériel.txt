title UC 25 - Créer une aide (numéraire ou matériel)

Acteurs: Administrateur
Lifelines:
  Administrateur
  Interface Administration (UI Admin)
  Système de Gestion Aides (Backend/Système)
  Base de Données (DB)
  Service d'Audit (Audit Service)
  Service de Notification (Optionnel)

Flux:
  Administrateur -> UI Admin: Accéder section gestion aides
  Administrateur -> UI Admin: Cliquer "Enregistrer une nouvelle aide"
  UI Admin --> Administrateur: Afficher formulaire de saisie aide

  Administrateur -> UI Admin: Rechercher/Sélectionner mutualiste bénéficiaire [ID Mutualiste]
  UI Admin -> Système de Gestion Aides: Demander infos mutualiste [ID Mutualiste]
  Système de Gestion Aides -> DB: Récupérer infos mutualiste [ID Mutualiste]
  DB --> Système de Gestion Aides: Retourner infos
  Système de Gestion Aides --> UI Admin: Envoyer infos mutualiste (Optionnel)
  UI Admin --> Administrateur: Afficher infos mutualiste et types d'aides disponibles

  Administrateur -> UI Admin: Choisir type d'aide (Numéraire/Matériel) et saisir détails (Montant/Description, Date, Motif)
  Administrateur -> UI Admin: Cliquer "Enregistrer" / "Attribuer l'aide"

  UI Admin -> Système de Gestion Aides: Envoyer données de l'aide [ID Mutualiste, Données Aide]

  Système de Gestion Aides -> Système de Gestion Aides: Valider données saisies (Format, Obligatoire, Cohérence Type/Détails) (Alt A2)

  Alt [Validation réussie]
    Système de Gestion Aides -> DB: Créer nouvel enregistrement aide [Données Aide, ID Mutualiste]
    DB --> Système de Gestion Aides: Confirmation création
    Système de Gestion Aides -> Service d'Audit: Enregistrer action attribution aide (Qui, Quand, À Qui, Quelle Aide)
    Service d'Audit --> Système de Gestion Aides: Confirmation audit

    Système de Gestion Aides --> UI Admin: Indiquer Succès Enregistrement Aide
    UI Admin --> Administrateur: Afficher message succès ("Aide enregistrée...")

    Opt [Notification au mutualiste (Exc E3)]
      Système de Gestion Aides -> Service de Notification: Envoyer notification aide attribuée [ID Mutualiste, Infos Aide]

  Alt [Validation KO (Alt A2)]
    Système de Gestion Aides --> UI Admin: Indiquer Échec Validation avec erreurs
    UI Admin --> Administrateur: Afficher messages d'erreur sur formulaire

  Alt [Erreur Système lors enregistrement (Exc E2)]
    Système de Gestion Aides -> Système de Gestion Aides: Enregistrer log d'erreur technique
    Système de Gestion Aides --> UI Admin: Indiquer Échec Technique
    UI Admin --> Administrateur: Afficher message d'erreur générique

  Alt [Mutualiste introuvable (Exc E1)]
    DB --> Système de Gestion Aides: Indiquer mutualiste non trouvé
    Système de Gestion Aides --> UI Admin: Indiquer erreur (mutualiste introuvable)
    UI Admin --> Administrateur: Afficher message d'erreur

  Alt [Annulation par l'Administrateur (Alt A1)]
    Administrateur --> UI Admin: Cliquer "Annuler"
    UI Admin --> Administrateur: Rediriger (pas d'action backend)
