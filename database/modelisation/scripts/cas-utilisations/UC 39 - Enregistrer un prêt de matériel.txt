title UC 39 - Enregistrer un prêt de matériel

Acteurs: Administrateur
Lifelines:
  Administrateur
  Interface Administration (UI Admin)
  Système de Gestion Prêts Matériel (Backend/Système)
  Système d'Inventaire Matériel (Backend/Système - si distinct)
  Base de Données (DB)
  Service d'Audit (Audit Service)
  Service de Notification (Optionnel)

Flux:
  Administrateur -> UI Admin: Accéder section gestion prêts matériel
  Administrateur -> UI Admin: Cliquer "Enregistrer un prêt de matériel"
  UI Admin --> Administrateur: Afficher formulaire de saisie prêt matériel

  Administrateur -> UI Admin: Rechercher/Sélectionner mutualiste emprunteur [ID Mutualiste]
  UI Admin -> Système de Gestion Prêts Matériel: Demander infos mutualiste (pour éligibilité) [ID Mutualiste]
  Système de Gestion Prêts Matériel -> DB: Récupérer infos mutualiste [ID Mutualiste]
  DB --> Système de Gestion Prêts Matériel: Retourner infos
  Système de Gestion Prêts Matériel --> UI Admin: Envoyer infos mutualiste (Optionnel)

  Administrateur -> UI Admin: Rechercher/Sélectionner matériel à prêter [ID Matériel/Référence]
  UI Admin -> Système d'Inventaire Matériel: Demander statut et infos matériel [ID Matériel]
  Système d'Inventaire Matériel -> DB: Récupérer statut et infos matériel [ID Matériel]

  Alt [Matériel trouvé et Disponible]
    DB --> Système d'Inventaire Matériel: Retourner statut Disponible et infos
    Système d'Inventaire Matériel --> UI Admin: Envoyer infos matériel et confirmer disponibilité
    UI Admin --> Administrateur: Afficher infos matériel et confirmer disponibilité

    Administrateur -> UI Admin: Saisir dates de prêt (Début, Retour Prévu) et infos sup. (Optionnel)
    Administrateur -> UI Admin: Cliquer "Enregistrer le prêt"

    UI Admin -> Système de Gestion Prêts Matériel: Envoyer données du prêt [ID Mutualiste, ID Matériel, Dates, Infos sup.]

    Système de Gestion Prêts Matériel -> Système de Gestion Prêts Matériel: Valider données (Alt A2) et éligibilité mutualiste (Alt A4)

    Alt [Validation et éligibilité réussies]
      Système de Gestion Prêts Matériel -> DB: Créer nouvel enregistrement prêt matériel [Données Prêt]
      DB --> Système de Gestion Prêts Matériel: Confirmation création prêt
      Système de Gestion Prêts Matériel -> Système d'Inventaire Matériel: Mettre à jour statut matériel à "Prêté" [ID Matériel, ID Prêt, Date Retour Prévue]
      Système d'Inventaire Matériel -> DB: Mettre à jour statut matériel [ID Matériel]
      DB --> Système d'Inventaire Matériel: Confirmation statut matériel
      Système d'Inventaire Matériel --> Système de Gestion Prêts Matériel: Confirmation mise à jour statut
      Système de Gestion Prêts Matériel -> Service d'Audit: Enregistrer action prêt matériel (Qui, Quand, Quoi, À Qui)
      Service d'Audit --> Système de Gestion Prêts Matériel: Confirmation audit

      Système de Gestion Prêts Matériel --> UI Admin: Indiquer Succès Enregistrement Prêt
      UI Admin --> Administrateur: Afficher message succès

      Opt [Notification au mutualiste (Exc E3)]
        Système de Gestion Prêts Matériel -> Service de Notification: Envoyer notification prêt matériel [ID Mutualiste, Infos Prêt Matériel]

    Alt [Validation ou éligibilité KO (Alt A2, A4)]
      Système de Gestion Prêts Matériel --> UI Admin: Indiquer Échec Validation/Éligibilité avec erreurs/motifs
      UI Admin --> Administrateur: Afficher messages d'erreur sur formulaire

    Alt [Erreur Système lors enregistrement/mise à jour (Exc E2)]
      Système de Gestion Prêts Matériel -> Système de Gestion Prêts Matériel: Enregistrer log d'erreur technique
      Système de Gestion Prêts Matériel --> UI Admin: Indiquer Échec Technique
      UI Admin --> Administrateur: Afficher message générique

  Alt [Matériel introuvable ou indisponible (Alt A3)]
    DB --> Système d'Inventaire Matériel: Indiquer introuvable ou statut non Disponible
    Système d'Inventaire Matériel --> UI Admin: Indiquer erreur (matériel introuvable/indisponible)
    UI Admin --> Administrateur: Afficher message d'erreur

  Alt [Mutualiste introuvable (Exc E1)]
    DB --> Système de Gestion Prêts Matériel: Indiquer mutualiste non trouvé
    Système de Gestion Prêts Matériel --> UI Admin: Indiquer erreur (mutualiste introuvable)
    UI Admin --> Administrateur: Afficher message d'erreur

  Alt [Annulation par l'Administrateur (Alt A1)]
    Administrateur --> UI Admin: Cliquer "Annuler"
    UI Admin --> Administrateur: Rediriger (pas d'action backend)
