title UC 5 - Valider les donnees un mutualiste

Acteurs: Administrateur
Lifelines:
  Administrateur
  Interface Administration (UI Admin)
  Système de Gestion Adhérents (Backend/Système)
  Base de Données (DB)
  Service d'Audit (Audit Service)
  Service de Notification (Email/SMS Service)

Flux:
  Administrateur -> UI Admin: Accéder section gestion adhérents
  Administrateur -> UI Admin: Afficher liste mutualistes en attente validation (potentiellement)
  Administrateur -> UI Admin: Sélectionner mutualiste à valider [ID Mutualiste]

  UI Admin -> Système de Gestion Adhérents: Demander informations mutualiste et documents [ID Mutualiste]
  Système de Gestion Adhérents -> DB: Récupérer informations mutualiste et références documents [ID Mutualiste]

  Alt [Mutualiste trouvé et éligible à validation]
    DB --> Système de Gestion Adhérents: Retourner informations et références
    Système de Gestion Adhérents --> UI Admin: Envoyer informations et références
    UI Admin --> Administrateur: Afficher informations complètes et documents associés

    Administrateur -> Administrateur: Examiner informations et documents
    Administrateur -> UI Admin: Cliquer sur "Valider" ou "Refuser la validation"

    Alt [Administrateur choisit "Valider" (Scénario Principal)]
      UI Admin -> Système de Gestion Adhérents: Envoyer requête de validation [ID Mutualiste]
      Système de Gestion Adhérents -> DB: Mettre à jour statut mutualiste à "Validé" / "Actif" [ID Mutualiste]
      DB --> Système de Gestion Adhérents: Confirmation mise à jour statut
      Système de Gestion Adhérents -> DB: Activer compte utilisateur associé (si nécessaire) [ID Utilisateur]
      DB --> Système de Gestion Adhérents: Confirmation activation compte
      Système de Gestion Adhérents -> Service d'Audit: Enregistrer action validation (Qui, Quand, Mutualiste)
      Service d'Audit --> Système de Gestion Adhérents: Confirmation audit

      Système de Gestion Adhérents -> Service de Notification: Envoyer notification de validation au mutualiste
      Opt [Échec envoi notification (Scénario d'Exception E3)]
        Service de Notification --> Système de Gestion Adhérents: Indiquer échec envoi
        Système de Gestion Adhérents -> Système de Gestion Adhérents: Enregistrer log échec notification
        Système de Gestion Adhérents --> UI Admin: Indiquer Succès Validation AVEC avertissement
      Else [Envoi notification réussi]
        Service de Notification --> Système de Gestion Adhérents: Indiquer succès envoi
        Système de Gestion Adhérents --> UI Admin: Indiquer Succès Validation

      UI Admin --> Administrateur: Afficher message de confirmation succès

    Alt [Administrateur choisit "Refuser" (Scénario Alternatif A1)]
      UI Admin --> Administrateur: Potentiellement afficher champ saisie motif refus
      Administrateur -> UI Admin: Confirmer refus (avec motif si applicable)
      UI Admin -> Système de Gestion Adhérents: Envoyer requête de refus validation [ID Mutualiste, Motif]
      Système de Gestion Adhérents -> DB: Mettre à jour statut mutualiste à "Validation Refusée" / "Informations Incomplètes" [ID Mutualiste]
      DB --> Système de Gestion Adhérents: Confirmation mise à jour statut
      Système de Gestion Adhérents -> Service d'Audit: Enregistrer action refus validation (Qui, Quand, Mutualiste, Motif)
      Service d'Audit --> Système de Gestion Adhérents: Confirmation audit

      Opt [Notification refus configurée]
        Système de Gestion Adhérents -> Service de Notification: Envoyer notification de refus au mutualiste (avec motif)

      Système de Gestion Adhérents --> UI Admin: Indiquer Succès Refus Validation
      UI Admin --> Administrateur: Afficher message de confirmation refus

    Alt [Annulation par l'Administrateur (Scénario Alternatif A2)]
      Administrateur --> UI Admin: Quitter page/cliquer "Annuler"
      UI Admin --> Administrateur: Rediriger (pas d'action backend)

  Alt [Mutualiste introuvable ou statut non valide (Scénario d'Exception E1)]
    DB --> Système de Gestion Adhérents: Indiquer mutualiste non trouvé ou statut non valide
    Système de Gestion Adhérents --> UI Admin: Indiquer erreur (mutualiste introuvable/statut non valide)
    UI Admin --> Administrateur: Afficher message d'erreur
    UI Admin --> Administrateur: Rediriger

  Alt [Erreur Système lors traitement (Scénario d'Exception E2)]
    Système de Gestion Adhérents -> Système de Gestion Adhérents: Enregistrer log d'erreur technique
    Système de Gestion Adhérents --> UI Admin: Indiquer Échec Technique
    UI Admin --> Administrateur: Afficher message d'erreur générique
