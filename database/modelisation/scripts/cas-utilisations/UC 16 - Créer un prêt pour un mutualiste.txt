title UC 16 - Créer un prêt pour un mutualiste

Acteurs: Administrateur
Lifelines:
  Administrateur
  Interface Administration (UI Admin)
  Système de Gestion Prêts (Backend/Système)
  Base de Données (DB)
  Service d'Audit (Audit Service)
  Service de Notification (Optionnel)

Flux:
  Administrateur -> UI Admin: Accéder section gestion prêts
  Administrateur -> UI Admin: Cliquer "Créer nouveau prêt"
  UI Admin --> Administrateur: Afficher formulaire de création prêt

  Administrateur -> UI Admin: Rechercher/Sélectionner mutualiste bénéficiaire [ID Mutualiste]
  UI Admin -> Système de Gestion Prêts: Demander infos éligibilité/historique prêts mutualiste [ID Mutualiste]
  Système de Gestion Prêts -> DB: Récupérer infos mutualiste/prêts [ID Mutualiste]
  DB --> Système de Gestion Prêts: Retourner infos
  Système de Gestion Prêts --> UI Admin: Envoyer infos résumé mutualiste (éligibilité, etc.)
  UI Admin --> Administrateur: Afficher infos résumé (Optionnel)

  Administrateur -> UI Admin: Saisir détails du prêt (Montant, Durée, Taux, Périodicité, etc.)
  Administrateur -> UI Admin: Cliquer "Enregistrer" / "Créer le prêt"

  UI Admin -> Système de Gestion Prêts: Envoyer données du nouveau prêt [ID Mutualiste, Données Prêt]

  Système de Gestion Prêts -> Système de Gestion Prêts: Valider données saisies et éligibilité métier (Alt A2, A3, A4)

  Alt [Validation réussie]
    Système de Gestion Prêts -> Système de Gestion Prêts: Calculer et générer échéancier
    Système de Gestion Prêts -> DB: Créer enregistrement prêt [Données Prêt, ID Mutualiste]
    DB --> Système de Gestion Prêts: Confirmation création prêt
    Système de Gestion Prêts -> DB: Associer et enregistrer échéancier généré [ID Prêt, Données Échéancier]
    DB --> Système de Gestion Prêts: Confirmation enregistrement échéancier
    Système de Gestion Prêts -> Service d'Audit: Enregistrer action création prêt (Qui, Quand, Détails)
    Service d'Audit --> Système de Gestion Prêts: Confirmation audit

    Système de Gestion Prêts --> UI Admin: Indiquer Succès Création
    UI Admin --> Administrateur: Afficher message succès ("Prêt créé...")

    Opt [Notification au mutualiste (Exc E3)]
      Système de Gestion Prêts -> Service de Notification: Envoyer notification création prêt [ID Mutualiste, Infos Prêt/Échéancier]

  Alt [Validation ou éligibilité KO (Alt A2, A3, A4)]
    Système de Gestion Prêts --> UI Admin: Indiquer Échec Validation/Éligibilité avec erreurs/motifs
    UI Admin --> Administrateur: Afficher messages d'erreur sur formulaire

  Alt [Erreur Système lors création/calcul (Exc E2)]
    Système de Gestion Prêts -> Système de Gestion Prêts: Enregistrer log d'erreur technique
    Système de Gestion Prêts --> UI Admin: Indiquer Échec Technique
    UI Admin --> Administrateur: Afficher message d'erreur générique

  Alt [Mutualiste introuvable (Exc E1)]
    DB --> Système de Gestion Prêts: Indiquer mutualiste non trouvé
    Système de Gestion Prêts --> UI Admin: Indiquer erreur (mutualiste introuvable)
    UI Admin --> Administrateur: Afficher message d'erreur

  Alt [Annulation par l'Administrateur (Alt A1)]
    Administrateur --> UI Admin: Cliquer "Annuler"
    UI Admin --> Administrateur: Rediriger (pas d'action backend)
