title UC 9 - Mettre à jour son profil

Acteurs: Mutualiste
Lifelines:
  Mutualiste
  Interface Utilisateur (UI)
  Système de Gestion Profil (Backend/Système)
  Base de Données (DB)
  Service d'Audit (Audit Service)
  Service de Notification (Optionnel - Alerte Modification)

Flux:
  Mutualiste -> UI: Se connecter à son espace personnel (UC 1)
  Mutualiste -> UI: Naviguer vers section "Mon Profil"

  UI -> Système de Gestion Profil: Demander informations du profil [ID Mutualiste]
  Système de Gestion Profil -> DB: Récupérer informations du profil [ID Mutualiste]
  DB --> Système de Gestion Profil: Retourner informations du profil
  Système de Gestion Profil --> UI: Envoyer informations du profil
  UI --> Mutualiste: Afficher formulaire de profil pré-rempli

  Mutualiste -> UI: Modifier les informations dans les champs éditables (Pseudo, Téléphone, Nouveau Mot de Passe, Confirmation, Ancien Mot de Passe)
  Mutualiste -> UI: Cliquer sur "Enregistrer" / "Mettre à jour"

  UI -> Système de Gestion Profil: Envoyer données du profil modifiées [ID Mutualiste, Données Modifiées]

  Système de Gestion Profil -> Système de Gestion Profil: Valider données modifiées (Format, Obligatoire, Cohérence Mots de Passe, Ancien Mot de Passe si requis)

  Alt [Validation réussie]
    Opt [Mot de passe changé]
      Système de Gestion Profil -> DB: Vérifier Ancien Mot de Passe [ID Mutualiste, Ancien Mot de Passe Saisi]
      DB --> Système de Gestion Profil: Résultat vérification Ancien Mot de Passe
      Alt [Ancien Mot de Passe correct]
        Système de Gestion Profil -> DB: Mettre à jour Mot de Passe (Hachage) [ID Mutualiste, Nouveau Mot de Passe Haché]
        DB --> Système de Gestion Profil: Confirmation mise à jour MP
      Alt [Ancien Mot de Passe incorrect (Scénario Alternatif A4)]
        Système de Gestion Profil --> UI: Indiquer Échec Validation (Ancien MP incorrect)
        UI --> Mutualiste: Afficher message erreur (Ancien MP incorrect)
        UI --> Mutualiste: Rester sur formulaire (Fin du flux pour cette alternative)
        [Fin de cet Alt - la suite du flux ne s'applique pas]

    [Reprise du flux principal si MP non changé OU Ancien MP correct]
    Système de Gestion Profil -> DB: Mettre à jour autres informations profil (Pseudo, Téléphone, etc.) [ID Mutualiste, Données]
    DB --> Système de Gestion Profil: Confirmation mise à jour données
    Système de Gestion Profil -> Service d'Audit: Enregistrer action modification profil (Qui, Quand, Champs modifiés)
    Service d'Audit --> Système de Gestion Profil: Confirmation audit

    Opt [Alerte notification sur modification profil/mot de passe]
      Système de Gestion Profil -> Service de Notification: Envoyer alerte au mutualiste

    Système de Gestion Profil --> UI: Indiquer Succès Modification Profil
    UI --> Mutualiste: Afficher message de confirmation succès

  Alt [Validation échoue (Données invalides A2, Nouveaux MP non identiques A3)]
    Système de Gestion Profil --> UI: Indiquer Échec Validation avec erreurs
    UI --> Mutualiste: Afficher messages d'erreur sur formulaire
    UI --> Mutualiste: Rester sur formulaire avec modifications

  Alt [Erreur Système lors sauvegarde (Scénario d'Exception E1)]
    Système de Gestion Profil -> Système de Gestion Profil: Enregistrer log d'erreur technique
    Système de Gestion Profil --> UI: Indiquer Échec Technique
    UI --> Mutualiste: Afficher message d'erreur générique
    UI --> Mutualiste: Rester sur formulaire ou rediriger

  Alt [Annulation par le Mutualiste (Scénario Alternatif A1)]
    Mutualiste --> UI: Cliquer "Annuler" / Quitter page
    UI --> Mutualiste: Rediriger (pas d'action backend)
