title UC 66 - Enregistrer une dépense de fonctionnement

Acteurs: Administrateur
Lifelines:
  Administrateur
  Interface Administration (UI Admin)
  Système Financier (Backend/Système)
  Base de Données (DB)
  Service d'Audit (Audit Service)
  Système de Gestion Documents (Optionnel - Justificatif)

Flux:
  Administrateur -> UI Admin: Se connecter à interface administration
  Administrateur -> UI Admin: Naviguer vers section dépenses de fonctionnement
  UI Admin --> Administrateur: Afficher interface avec option "Nouvelle dépense"

  Administrateur -> UI Admin: Cliquer "Enregistrer une nouvelle dépense"
  UI Admin --> Administrateur: Afficher formulaire de saisie dépense

  Administrateur -> UI Admin: Saisir détails dépense (Montant, Date, Bénéficiaire, Catégorie, Description), (Optionnel) Mode paiement, Joindre justificatif
  Administrateur -> UI Admin: Cliquer "Enregistrer la dépense"

  UI Admin -> Système Financier: Envoyer données nouvelle dépense et justificatif (Optionnel) [Données Dépense, Fichier]

  Système Financier -> Système Financier: Valider données dépense (Alt A2) et justificatif (Alt A4)

  Alt [Validation réussie]
    Système Financier -> DB: Créer nouvel enregistrement dépense [Données Dépense]
    DB --> Système Financier: Confirmation création dépense
    Opt [Justificatif joint]
      Système Financier -> Système de Gestion Documents: Traiter et associer justificatif à dépense
      Système de Gestion Documents --> Système Financier: Statut traitement justificatif (Alt A4 si échec)
    Système Financier -> Service d'Audit: Enregistrer action enregistrement dépense (Qui, Quand, Quoi)
    Service d'Audit --> Système Financier: Confirmation audit
    Système Financier --> UI Admin: Indiquer Succès Enregistrement Dépense
    UI Admin --> Administrateur: Afficher message confirmation succès

  Alt [Validation KO (Alt A2) ou Échec Justificatif (Alt A4)]
    Système Financier --> UI Admin: Indiquer Échec Enregistrement avec erreurs/motifs
    UI Admin --> Administrateur: Afficher messages d'erreur sur formulaire

  Alt [Erreur Système lors enregistrement (Exc E1)]
    Système Financier -> Système Financier: Enregistrer log d'erreur technique
    Système Financier --> UI Admin: Indiquer Échec Technique
    UI Admin --> Administrateur: Afficher message générique

  Alt [Annulation par l'Administrateur (Alt A1)]
    Administrateur --> UI Admin: Cliquer "Annuler" / Quitter
    UI Admin --> Administrateur: Abandonner formulaire