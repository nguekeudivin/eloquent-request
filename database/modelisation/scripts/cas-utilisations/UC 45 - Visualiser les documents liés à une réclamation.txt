title UC 45 - Visualiser les documents liés à une réclamation

Acteurs: Mutualiste
Lifelines:
  Mutualiste
  Interface Utilisateur (UI)
  Système de Gestion Réclamations (Backend/Système)
  Système de Gestion Documents (Backend/Système)
  Base de Données (DB)
  Stockage Fichiers (Serveur/Cloud)

Flux:
  Mutualiste -> UI: Se connecter à son espace personnel (UC 1)
  Mutualiste -> UI: Naviguer vers section "Mes Réclamations" (UC 44 implicite)
  Mutualiste -> UI: Sélectionner une réclamation [ID Réclamation] (UC 44 implicite)

  UI -> Système de Gestion Réclamations: Demander informations réclamation pour accès documents [ID Réclamation]
  Système de Gestion Réclamations -> DB: Vérifier existence réclamation et droits [ID Réclamation, ID Mutualiste]

  Alt [Réclamation trouvée et accessible]
    DB --> Système de Gestion Réclamations: Confirmation réclamation et références documents visibles pour Mutualiste
    Système de Gestion Réclamations -> Système de Gestion Documents: Demander liste des documents associés (visibles pour Mutualiste) [ID Réclamation]
    Système de Gestion Documents -> DB: Interroger base pour métadonnées documents (visibles) [ID Réclamation]

    Alt [Documents trouvés et visibles (Alt A2 si aucun)]
      DB --> Système de Gestion Documents: Retourner métadonnées documents (visibles)
      Système de Gestion Documents --> UI: Envoyer liste des documents (Métadonnées: Nom, Type, Date, Origine)
      UI --> Mutualiste: Afficher liste des documents associés à la réclamation

      Opt [Mutualiste sélectionne un document à visualiser/télécharger]
        Mutualiste -> UI: Sélectionner un document [ID Document]
        UI -> Système de Gestion Documents: Demander accès/contenu document [ID Document]

        Système de Gestion Documents -> DB: Récupérer chemin/référence fichier physique [ID Document]
        DB --> Système de Gestion Documents: Retourner référence fichier
        Système de Gestion Documents -> Système de Gestion Documents: Vérifier droits Mutualiste sur ce document spécifique
        Alt [Droits de consultation/téléchargement OK]
          Système de Gestion Documents -> Stockage Fichiers: Récupérer contenu fichier [Chemin Fichier]
          Stockage Fichiers --> Système de Gestion Documents: Retourner contenu fichier
          Alt [Fichier récupéré avec succès]
            Système de Gestion Documents --> UI: Envoyer contenu document
            UI --> Mutualiste: Afficher document (Visionneuse intégrée ou Téléchargement)
          Alt [Fichier introuvable/corrompu (Alt A3, Exc E2 partie 2)]
            Système de Gestion Documents -> Système de Gestion Documents: Enregistrer erreur fichier
            Système de Gestion Documents --> UI: Indiquer Échec Accès Document
            UI --> Mutualiste: Afficher message d'erreur ("Document non accessible")
        Alt [Droits de consultation/téléchargement KO (Alt A3 partie 2)]
          Système de Gestion Documents --> UI: Indiquer Accès Refusé
          UI --> Mutualiste: Afficher message ("Vous n'avez pas les droits de consulter ce document")


    Alt [Aucun document associé ou consultable (Alt A2)]
      DB --> Système de Gestion Documents: Indiquer aucun document / aucun visible
      Système de Gestion Documents --> UI: Indiquer aucun document visible
      UI --> Mutualiste: Afficher message "Aucun document consultable pour cette réclamation"

    Alt [Erreur Système lors récupération liste documents (Exc E1 partie 1)]
      Système de Gestion Documents -> Système de Gestion Documents: Enregistrer log erreur
      Système de Gestion Documents --> UI: Indiquer Échec Récupération Liste Documents
      UI --> Mutualiste: Afficher message d'erreur générique

  Alt [Réclamation introuvable/non accessible (Alt A1 via UC 44)]
    DB --> Système de Gestion Réclamations: Indiquer introuvable
    Système de Gestion Réclamations --> UI: Indiquer erreur (réclamation introuvable)
    UI --> Mutualiste: Afficher message d'erreur (Typiquement géré par l'UC appelant, UC 44)

  Alt [Erreur Système lors vérification/accès réclamation (Exc E1 partie 2)]
    Système de Gestion Réclamations -> Système de Gestion Réclamations: Enregistrer log erreur
    Système de Gestion Réclamations --> UI: Indiquer Échec Vérification Réclamation
    UI --> Mutualiste: Afficher message d'erreur générique
